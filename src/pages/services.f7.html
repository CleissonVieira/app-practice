<template>
  <div data-name="services">
    <div class="block">
      <a href="/services/service-options/" class="button button-raised button-fill">Solicitar serviços</a>
    </div>

    <div class="card">
      <div class="list media-list no-margin">
        <ul>
          {{#if services}}
            {{#each services}}
              <li>
                <a href="/services/{{this.id}}/" class="item-link item-content chat">
                  <div class="item-inner">
                    <div class="item-title-row">
                      <div class="item-title">{{this.title}}</div>
                      <div class="item-after">{{this.created_at}}</div>
                    </div>
                    <div class="item-text no-wrap">{{this.description}}</div>
                    <div class="item-text margin-top-half">Última atualização há {{this.updated_at}}</div>
                  </div>
                </a>
              </li>
            {{/each}}
          {{else}}
            {{#each '123'}}
              <li>
                <a class="item-link item-content skeleton-text skeleton-effect-blink">
                  <div class="item-inner">
                    <div class="item-title-row">
                      <div class="item-title">____________</div>
                      <div class="item-after">____</div>
                    </div>
                    <div class="item-text no-wrap">____________________________________</div>
                  </div>
                </a>
            </li>
            {{/each}}
          {{/if}}
        </ul>
      </div>
    </div>

  </div>
</template>
<script>
  export default {
    data: function () {
      return {
        services: null,
      }
    },
    methods: {
      processDate: function (date) {
        date = new Date(date)
        const now = new Date()
        let difference = now - date
        // Years
        const years = Math.floor(difference / (1000*60*60*24*30*12))
        if (years > 0)
          if (years == 1)
            return years + ' ano'
          else
            return years + ' anos'
        // Months
        const months = Math.floor(difference / (1000*60*60*24*30))
        if (months > 0)
          if (months == 1)
            return months + ' mês'
          else
            return months + ' meses'
        // Days
        const days = Math.floor(difference / (1000*60*60*24))
        if (days > 0)
          if (days == 1)
            return days + ' dia'
          else
            return days + ' dias'
        // Seconds
        const seconds = Math.floor(difference / (1000*60*60))
        if (seconds > 0)
          if (seconds == 1)
            return seconds + ' segundo'
          else
            return seconds + ' segundos'
        return date.toUpperCase().charAt(0).toUpperCase() + date.slice(1)
      },
      loadServices: function () {
        var self = this
        var app = self.$app

        app.storage.getRequestedServices(function (services) {
          if (services) {
            console.log(services)
            services = services.data
            console.log(services.length)
            // Processing data
            for (let i=0; i<services.length; i++) {
              services[i].created_at = self.processDate(services[i].created_at)
              services[i].updated_at = self.processDate(services[i].updated_at)
            }

            self.$setState({
              services: services
            })
          }
          else {
            app.dialog.alert('Falha em sua conexão, tente novamente!')
          }
        })
      },
    },
    on: {
      tabInit: function(e, page) {
        this.loadServices()
      }
    }
  }
</script>